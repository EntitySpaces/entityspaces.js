<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<script type="text/javascript">
    window.myNS = {}; //define the namespace
</script>
<script src="../../Libs/jquery-1.7.1.js" type="text/javascript"></script>
<script src="../../Libs/knockout-2.0.0.debug.js" type="text/javascript"></script>
<script src="../../Libs/json2.js" type="text/javascript"></script>
<script src="../../Build/entityspaces.debug.js" type="text/javascript"></script>
<script src="Generated/Employees.js" type="text/javascript"></script>
<script src="Generated/Orders.js" type="text/javascript"></script>
<script src="Generated/OrderDetails.js" type="text/javascript"></script>
<head>
    <title>EntitySpaces.js Basic Example</title>
</head>
<body>
    <button onclick="test1()"/>Test 1</button><br /><br />
    <button onclick="test2()"/>Test 2</button><br /><br />
    <button onclick="test3()"/>Test 3</button><br /><br />
    <button onclick="test4()"/>Test 4</button><br /><br />
</body>
</html>

<script language="javascript" type="text/javascript">


    es.dataProvider = new es.XMLHttpRequestProvider();
    //es.dataProvider.baseURL = "http://localhost/esService/esJson.svc/";
    es.dataProvider.baseURL = "http://www.entityspaces.net/Knockout/Part1/esService/esJson.svc/";

    test1 = function () {

        // Load an employee with hierarchical model and save hierarchical data back to the server
        var emp = new es.objects.Employees();
        emp.loadByPrimaryKey(2);

        emp.FirstName("This");
        emp.OrdersCollectionByEmployeeID()[0].ShipCity(Math.random().toString().substr(0, 4));
        emp.save();

        // Collection load/save
        var coll = new es.objects.EmployeesCollection();
        coll.loadAll();

        coll()[0].FirstName("Rocks!!");
        coll.save();
    }

    test2 = function () {

        //
        // Hodge Podge of Asyc calls

        var request = es.dataProvider.makeRequest("http://localhost/esService/esJson.svc/", "Employees_LoadForHierarchical", null);

        es.dataProvider.makeRequest("http://localhost/esService/esJson.svc/", "Employees_LoadForHierarchical", null,
        function (data) {
            var ii = 0;
        },
        function (status, error) {
            var jj = 0;
        });

        var emp = new es.objects.Employees();
        emp.loadByPrimaryKey(2, function (data) {
            var iii = 0;
            emp.FirstName("sync" + "!!!");
        });

        emp.save();

        var coll = new es.objects.EmployeesCollection();
        coll.loadAll();

        coll()[0].FirstName("Rocks!!");

        coll.save(function (data) {
            var klkl = 9;
        });

        var setbreakpointhere = 1;
    }

    test3 = function () {

        // Add a single record
        var emp = new es.objects.Employees();
        emp.FirstName("Just");
        emp.LastName("Added");
        emp.save();

        var employeeId = emp.EmployeeID();

        // Add two new employees through a collection
        var coll = new es.objects.EmployeesCollection();

        emp = new es.objects.Employees();
        emp.FirstName("Just1");
        emp.LastName("Added1");
        coll.push(emp);

        emp = new es.objects.Employees();
        emp.FirstName("Just2");
        emp.LastName("Added2");
        coll.push(emp);

        coll.save();

        var employeeId_1 = coll()[0].EmployeeID();
        var employeeId_2 = coll()[1].EmployeeID();
    }

    test4 = function () {

        // Add a single record
        var emp = new es.objects.Employees();
        emp.FirstName("Just");
        emp.LastName("Added");
        emp.save();

        var employeeId = emp.EmployeeID();

        emp = new es.objects.Employees();
        emp.loadByPrimaryKey(employeeId);
        emp.markAsDeleted();
        emp.save();

        emp = new es.objects.Employees();
        var loaded = emp.loadByPrimaryKey(employeeId);

        employeeId = emp.EmployeeID();
    }

</script>